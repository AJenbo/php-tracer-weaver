php-tracer-weaver
===
[![Build Status](https://travis-ci.org/AJenbo/php-tracer-weaver.svg?branch=master)](https://travis-ci.org/AJenbo/php-tracer-weaver)
[![Codacy Badge](https://api.codacy.com/project/badge/Grade/cc2ad72a9e4c47a9bbc84037a29857a8)](https://www.codacy.com/app/AJenbo/php-tracer-weaver?utm_source=github.com&amp;utm_medium=referral&amp;utm_content=AJenbo/php-tracer-weaver&amp;utm_campaign=Badge_Grade)
[![Maintainability](https://api.codeclimate.com/v1/badges/412a2f0203c7ed255bee/maintainability)](https://codeclimate.com/github/AJenbo/php-tracer-weaver/maintainability)
[![BCH compliance](https://bettercodehub.com/edge/badge/AJenbo/php-tracer-weaver?branch=master)](https://bettercodehub.com/)
[![Coverage Status](https://coveralls.io/repos/github/AJenbo/php-tracer-weaver/badge.svg?branch=master)](https://coveralls.io/github/AJenbo/php-tracer-weaver?branch=master)

**php-tracer-weaver** is a tool for analysing parameter types in PHP code, using a combination of static and runtime analysis. It relies on the [xdebug extension](http://www.xdebug.org/docs/execution_trace) to trace function calls. The result of the analysis can then be used to generate docblock comments, with the proper type annotations.

Usage
---

The basic usage of tracer-weaver is to write a piece of code (If you have unit tests/examples, they would be a good candidate), that utilises the code to manipulate. Run this example with the tracer, then use the weaver to generate docblocks from the output of the tracer.

See under `example/` for some basic examples.

The project consists of two main tools:

* `bin/trace.sh`
* `bin/php-tracer-weaver`

`bin/trace.sh`
---

This is just a wrapper around php + xdebug. Use it in lieu of `php` to execute a php script. It will run normally, but the code is traced and the output is dumped in `dumpfile.xt`. You can also manually configure xdebug to generate the dumpfile.

Sample usage:

    bin/trace.sh test.php

`bin/php-tracer-weaver`
---

This tool takes a dumpfile (Generated by trace.sh) and a php-source file, and injects docblock comments into the php-source, using the type-information from the trace. The tool expects `dumpfile.xt` in the current directory, and takes the file to weave with as argument, printing the modified file to stdout. If you want to modify your code, pass the target file (can be the same as input) as second argument:

Sample usage:

    bin/php-tracer-weaver somelibrary.php somelibrary.php

The same dumpfile can be used to weave multiple files, by calling `weave.php` for each.

Running tests
---

There is a Dockerfile for getting an environment up and running. First install docker somehow, then issue:

    docker build -t phpweaver .
    docker run -it phpweaver

This will log you in to the machine. Run tests with:

    phpunit